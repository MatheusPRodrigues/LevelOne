@{
    ViewData["Title"] = "Atendimento Virtual";
}

<div class="container mt-4">
    <h2>Assistente Virtual</h2>

    <div id="chat" style="border:1px solid #ccc; border-radius:10px; padding:15px; height:300px; overflow-y:auto;"></div>

    <div class="mt-3 d-flex">
        <input type="text" id="mensagem" class="form-control" placeholder="Digite sua mensagem..." />
        <button id="enviar" class="btn btn-primary ms-2">Enviar</button>
    </div>
</div>

<script>
    let interacoes = 0; // contador de tentativas

    document.getElementById("enviar").addEventListener("click", async () => {
        const msg = document.getElementById("mensagem").value;
        if (!msg.trim()) return;

        const chat = document.getElementById("chat");
        chat.innerHTML += `<div><b>Você:</b> ${msg}</div>`;
        document.getElementById("mensagem").value = "";

        const response = await fetch("/Chatbot/EnviarMensagem", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: "mensagem=" + encodeURIComponent(msg)
        });

        const data = await response.json();
        chat.innerHTML += `<div><b>Bot:</b> ${data.resposta}</div>`;
        chat.scrollTop = chat.scrollHeight;

        interacoes++;

        // Após 3 tentativas, sugere abrir chamado
        if (interacoes >= 3) {
            chat.innerHTML += `
                <div class="mt-2 alert alert-info">
                    <b>Bot:</b> Parece que você ainda precisa de ajuda.
                    <button class="btn btn-sm btn-success ms-2" onclick="window.location='@Url.Action("Criar", "Chamados")'">
                        Abrir Chamado
                    </button>
                </div>
            `;
            interacoes = 0; // opcional, reinicia contador
        }
    });
</script>

